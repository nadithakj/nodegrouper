<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Meal Cleanup</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 300px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Meal Cleanup</h1>
  <a href="/" style="text-decoration:none;">â¬… Back</a>
  <br><br>

  <!-- Upload Form -->
  <form action="/meal_cleanup" method="post" enctype="multipart/form-data">
    <input type="file" name="file" required>
    <button type="submit">Upload</button>
  </form>

  {% if xml_preview %}
  <h2>Original XML Preview</h2>
  <textarea readonly>{{ xml_preview }}</textarea>
  {% endif %}

  {% if empty_tags %}
  <h2>Select Empty Tags to Remove</h2>
  <form action="/meal_cleanup_clean" method="post">
    <input type="hidden" name="xml_content" value="{{ xml_preview|e }}">
    {% for tag in empty_tags %}
      <input type="checkbox" name="tags_to_remove" value="{{ tag }}"> {{ tag }}<br>
    {% endfor %}
    <br>
    <button type="submit">Clean XML</button>
  </form>
  {% endif %}

  {% if cleaned_xml %}
  <h2>Cleaned XML</h2>
  <textarea readonly>{{ cleaned_xml }}</textarea>
  <br><br>
  <form id="downloadForm" action="/meal_download" method="post" onsubmit="launchConfetti()">
    <input type="hidden" name="file_content" value="{{ cleaned_xml|e }}">
    <button type="submit">Download Cleaned XML</button>
  </form>
  {% endif %}

  <script>
    function launchConfetti() {
      setTimeout(() => {
        confetti({
          particleCount: 150,
          spread: 70,
          origin: { y: 0.6 }
        });
      }, 100);
    }
  </script>
</body>
</html>
