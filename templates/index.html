<!DOCTYPE html>
<html>
<head>
    <title>XML Grouper</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 300px; }
        select, input[type="file"], button { margin: 5px 0; padding: 5px; }
        .section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>XML Grouper App</h1>

    <!-- Upload Section -->
    <div class="section">
        <h2>Upload XML</h2>
        <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <button type="submit">Upload</button>
        </form>
    </div>

    {% if xml_preview %}
    <!-- Parent Tag Selection -->
    <div class="section">
        <h2>Select Parent Tag to Group</h2>
        <form action="/select_key" method="post">
            <input type="hidden" name="xml_content" value="{{ xml_preview }}">
            <select name="selected_tag" required>
                {% for tag in tags %}
                    <option value="{{ tag }}" {% if tag==selected_tag %}selected{% endif %}>{{ tag }}</option>
                {% endfor %}
            </select>
            <button type="submit">Next</button>
        </form>
    </div>
    {% endif %}

    {% if keys %}
    <!-- Key Field and Child Tag Selection -->
    <div class="section">
        <h2>Key Field & Child Tags to Merge "{{ selected_tag }}"</h2>
        <form action="/group" method="post">
            <label>Key Field:</label>
            <select name="selected_key" required>
                {% for key in keys %}
                    <option value="{{ key }}" {% if key==selected_key %}selected{% endif %}>{{ key }}</option>
                {% endfor %}
            </select>
            <br><br>
            <label>Child Tags to Merge:</label>
            <select name="selected_child_tags" multiple size="5" required>
                {% for child in child_tags %}
                    <option value="{{ child }}" {% if child in selected_child_tags %}selected{% endif %}>{{ child }}</option>
                {% endfor %}
            </select>
            <br><br>
            <input type="hidden" name="xml_content" value="{{ xml_preview }}">
            <input type="hidden" name="selected_tag" value="{{ selected_tag }}">
            <button type="submit">Group</button>
        </form>
    </div>
    {% endif %}

    {% if xml_preview %}
    <!-- XML Preview -->
    <div class="section">
        <h2>XML Preview</h2>
        <textarea readonly>{{ xml_preview }}</textarea>
    </div>

    <!-- Download -->
    <div class="section">
        <form action="/download" method="post">
            <input type="hidden" name="file_content" value="{{ xml_preview }}">
            <button type="submit">Download Grouped XML</button>
        </form>
    </div>
    {% endif %}
</body>
</html>
